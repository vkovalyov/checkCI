name: merge PR

on:
  push:
    branches: [ develop ]

jobs:
  lint:
    name: Code style
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source code
        uses: actions/checkout@v2
      - name: Install Flutter
        uses: subosito/flutter-action@v1
        with:
          channel: 'stable'
      - name: Get packages in a Flutter project
        run: flutter pub get
      - name: Run lint
        run: dart analyze

    runTests:
      needs: lint
      name: Run tests and get coverage
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v1
        - uses: subosito/flutter-action@v1
        - name: Run tests
          run: |
            flutter test --coverage --no-sound-null-safety;
        - name: Upload reports to codecov
          env:
            CODECOV_TOKEN: ${{secrets.CODECOV_TOKEN}}
          run: |
            curl -Os https://uploader.codecov.io/latest/linux/codecov
            chmod +x codecov
            ./codecov -t ${CODECOV_TOKEN}
    buildServer:
      needs: runTests
      name: check build Server
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v1
        - uses: dart-lang/setup-dart@v1
        - run: dart pub get
        - run: dart compile kernel bin/itrapp_backend.dart
